---
title: "MTA Data Statistical Analysis"
author: "ChengYu, Lee"
output: html_document
date: "`r format(Sys.time(), '%Y-%m-%d')`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

# Background

- **Author**: ChengYu, Lee
- **Created At**: 2025-11-30
- **Research Motivation and Context (why are we interested in the findings?)：** We want to check whether the MTA ridership in same period increase after the policy implemented in early 2025.
- **Main Findings and Takeaways：** The daily ridership in same period increased significantly in 2025 compared to 2024.
- **Future Direction：** 

```{r}
library(dplyr)
library(ggplot2)
library(readr)
library(fixest)
library(tidyr)
```

```{r}
# Load input data here and please finish all the data manipulation here.
# Finish this block by printing the first ten observations of the data.
# Note:
# - You may only read data from /data/processed.
# - Files in /data/processed should already be cleaned and prepared for analysis.
# - Beyond simple filtering of observations or generating a small number of variables,
#   further data manipulation is not allowed. If more extensive changes are needed,
#   update the source data instead.
base_path = "~/Documents/DataScience/fa-25-econ-5166-group-3"
hourly_df = read_csv(file.path(base_path, "data/processed/mta-hourly-cbd.csv"))
daily_df = read_csv(file.path(base_path, "data/processed/mta-daily-cbd.csv"))
# Control sample period to be Jan to June in 2024 and 2025
daily_df <- daily_df %>%
  filter(Year %in% c(2024, 2025), Month <= 6)
hourly_df <- hourly_df %>%
  filter(Year %in% c(2024, 2025), Month <= 6)
head(hourly_df, 10)
head(daily_df, 10) 
```

```{r}
# Before conducting the analysis, report summary statistics for all variables 
# that will be used in this notebook:
#   - For numeric variables: mean, min, 25th percentile, median, 75th percentile, 
#     max, standard deviation, and number of observations.
#   - For categorical variables: number of observations and the counts/percentages 
#     of the ten most frequent categories.
# Conclude this block with the complete summary statistics.
summary(hourly_df$hour_sum)
summary(daily_df$daily_sum)
```

### The actual analysis starts below
```{r descriptive_stat}
summary_stat <- daily_df %>%
  mutate(
    trip_type = case_when(
      start_CBD == 0 & end_CBD == 0 ~ "Neither in CBD",
      start_CBD == 1 & end_CBD == 0 ~ "Origin only",
      start_CBD == 0 & end_CBD == 1 ~ "Dest only",
      start_CBD == 1 & end_CBD == 1 ~ "Both in CBD"
    )
  ) %>%
  group_by(Year, trip_type) %>%
  summarise(
    mean = mean(daily_sum, na.rm = TRUE),
    min = min(daily_sum, na.rm = TRUE),
    q25 = quantile(daily_sum, 0.25, na.rm = TRUE),
    q50 = quantile(daily_sum, 0.50, na.rm = TRUE), 
    q75 = quantile(daily_sum, 0.75, na.rm = TRUE),
    max = max(daily_sum, na.rm = TRUE),
    sd = sd(daily_sum, na.rm = TRUE),
    n = n()
  ) %>%
  arrange(trip_type, Year)
summary_stat

growth_rate <- summary_stat %>%
  select(Year, trip_type, mean) %>%
  pivot_wider(
    names_from = Year, 
    values_from = mean, 
    names_prefix = "Year_"
  ) %>%
  mutate(
    growth_rate = (Year_2025 - Year_2024) / Year_2024,
    diff_abs = Year_2025 - Year_2024
  ) %>%
  arrange(desc(growth_rate)) %>%
  select(-diff_abs)

growth_rate
```